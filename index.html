<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wordæ–‡æ¡£åˆ·é¢˜ç³»ç»Ÿ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        header {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        h1 {
            color: #667eea;
            font-size: 24px;
        }

        .upload-area {
            background: white;
            padding: 60px 40px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            text-align: center;
        }

        .upload-icon {
            width: 80px;
            height: 80px;
            background: #e0e7ff;
            border-radius: 50%;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
        }

        .format-example {
            background: #f9fafb;
            padding: 20px;
            border-radius: 8px;
            text-align: left;
            margin: 20px auto;
            max-width: 600px;
            font-size: 13px;
            line-height: 1.8;
        }

        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
        }

        .btn:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 14px;
        }

        input[type="file"] {
            display: none;
        }

        .progress-bar {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 14px;
            color: #4b5563;
        }

        .progress-track {
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: #667eea;
            transition: width 0.3s;
        }

        .question-card {
            background: white;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .question-header {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
        }

        .question-number {
            width: 40px;
            height: 40px;
            background: #667eea;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
        }

        .question-text {
            flex: 1;
            font-size: 17px;
            color: #1f2937;
            line-height: 1.8;
        }

        .options {
            margin: 20px 0;
        }

        .option {
            margin: 10px 0;
            padding: 15px 20px;
            background: #f9fafb;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            color: #1f2937;
            line-height: 1.6;
        }

        .option:hover {
            background: #eff6ff;
            border-color: #3b82f6;
        }

        .option.selected {
            background: #dbeafe;
            border-color: #3b82f6;
            font-weight: 500;
        }

        .option.correct {
            background: #d1fae5;
            border-color: #10b981;
        }

        .option.wrong {
            background: #fee2e2;
            border-color: #ef4444;
        }

        .type-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            margin-top: 10px;
        }

        .badge-choice {
            background: #dbeafe;
            color: #1e40af;
        }

        .badge-judge {
            background: #d1fae5;
            color: #065f46;
        }

        .badge-fill {
            background: #fef3c7;
            color: #92400e;
        }

        input[type="text"] {
            width: 100%;
            padding: 15px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 16px;
            font-family: inherit;
            transition: border-color 0.3s;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: #667eea;
        }

        input[type="text"]:disabled {
            background: #f9fafb;
            cursor: not-allowed;
        }

        .result-box {
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .result-correct {
            background: #d1fae5;
            border: 2px solid #10b981;
        }

        .result-wrong {
            background: #fee2e2;
            border: 2px solid #ef4444;
        }

        .result-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .result-correct .result-header {
            color: #065f46;
        }

        .result-wrong .result-header {
            color: #991b1b;
        }

        .result-detail {
            font-size: 14px;
            color: #374151;
            margin-top: 8px;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .btn-group button {
            flex: 1;
        }

        .btn-secondary {
            background: #e5e7eb;
            color: #374151;
        }

        .btn-secondary:hover {
            background: #d1d5db;
        }

        .btn-success {
            background: #10b981;
        }

        .btn-success:hover {
            background: #059669;
        }

        .answer-record {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .record-title {
            font-weight: bold;
            color: #1f2937;
            margin-bottom: 15px;
        }

        .record-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .record-item {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
        }

        .record-item.unanswered {
            background: #e5e7eb;
            color: #6b7280;
        }

        .record-item.correct {
            background: #10b981;
            color: white;
        }

        .record-item.wrong {
            background: #ef4444;
            color: white;
        }

        .record-item.active {
            box-shadow: 0 0 0 3px #667eea;
        }

        .hidden {
            display: none;
        }

        .score {
            color: #667eea;
            font-weight: bold;
        }

        .parse-info {
            background: #eff6ff;
            border: 1px solid #3b82f6;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            font-size: 14px;
            color: #1e40af;
            text-align: left;
            max-height: 400px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ“š Wordæ–‡æ¡£åˆ·é¢˜ç³»ç»Ÿ</h1>
            <button class="btn btn-small hidden" id="resetBtn" onclick="resetQuiz()">ğŸ”„ é‡æ–°å¼€å§‹</button>
        </header>

        <div id="uploadSection" class="upload-area">
            <div class="upload-icon">ğŸ“„</div>
            <h2 style="margin-bottom: 10px;">ä¸Šä¼ é¢˜ç›®æ–‡æ¡£</h2>
            <p style="color: #6b7280; margin-bottom: 20px;">æ”¯æŒ Word (.docx) æ ¼å¼ï¼Œç³»ç»Ÿå°†è‡ªåŠ¨è§£æé¢˜ç›®å’Œç­”æ¡ˆ</p>
            
            <div class="format-example">
                <strong>ä½ çš„æ–‡æ¡£æ ¼å¼ï¼š</strong><br><br>
                1. ç®—æ³•åˆ†æçš„ä¸¤ä¸ªä¸»è¦æ–¹é¢æ˜¯ï¼ˆ A ï¼‰<br>
                Aã€ç©ºé—´å¤æ‚åº¦å’Œæ—¶é—´å¤æ‚åº¦ Bã€æ­£ç¡®æ€§å’Œç®€æ˜æ€§<br><br>
                
                åˆ¤æ–­é¢˜ï¼š<br>
                1. æ•°æ®çš„é€»è¾‘ç»“æ„è¯´æ˜...ï¼ˆ Ã— ï¼‰<br><br>
                
                å¡«ç©ºé¢˜ï¼š<br>
                1. æ•°æ®å­˜å‚¨ç»“æ„çš„åŸºæœ¬å½¢å¼æœ‰ã€é“¾å¼å­˜å‚¨ç»“æ„ã€‘
            </div>

            <label for="fileInput" class="btn">ğŸ“¤ é€‰æ‹©Wordæ–‡æ¡£</label>
            <input type="file" id="fileInput" accept=".docx" onchange="handleFileUpload(event)">
            
            <div id="parseInfo" class="parse-info hidden"></div>
        </div>

        <div id="quizSection" class="hidden">
            <div class="progress-bar">
                <div class="progress-info">
                    <span>é¢˜ç›® <span id="currentNum">1</span> / <span id="totalNum">0</span></span>
                    <span class="score">å¾—åˆ†: <span id="score">0</span> / <span id="answered">0</span></span>
                </div>
                <div class="progress-track">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
            </div>

            <div class="question-card">
                <div class="question-header">
                    <div class="question-number" id="questionNum">1</div>
                    <div style="flex: 1;">
                        <div class="question-text" id="questionText"></div>
                        <div id="optionsDiv" class="options hidden"></div>
                        <span class="type-badge hidden" id="typeBadge"></span>
                    </div>
                </div>

                <div id="choiceOptions" class="options hidden"></div>
                
                <input type="text" id="answerInput" placeholder="è¯·è¾“å…¥ä½ çš„ç­”æ¡ˆ...">

                <div id="submitSection">
                    <button class="btn" style="width: 100%; margin-top: 20px;" onclick="checkAnswer()">âœ“ æäº¤ç­”æ¡ˆ</button>
                </div>

                <div id="resultSection" class="hidden">
                    <div class="result-box" id="resultBox">
                        <div class="result-header" id="resultHeader"></div>
                        <div class="result-detail">
                            <strong>ä½ çš„ç­”æ¡ˆï¼š</strong><span id="userAns"></span>
                        </div>
                        <div class="result-detail" id="correctAnsDiv">
                            <strong>æ­£ç¡®ç­”æ¡ˆï¼š</strong><span id="correctAns"></span>
                        </div>
                    </div>

                    <div class="btn-group">
                        <button class="btn btn-secondary" onclick="prevQuestion()" id="prevBtn">â† ä¸Šä¸€é¢˜</button>
                        <button class="btn" onclick="nextQuestion()" id="nextBtn">ä¸‹ä¸€é¢˜ â†’</button>
                        <button class="btn btn-success hidden" onclick="finishQuiz()" id="finishBtn">âœ“ å®Œæˆæµ‹éªŒ</button>
                    </div>
                </div>
            </div>

            <div class="answer-record hidden" id="recordSection">
                <div class="record-title">ç­”é¢˜è®°å½•</div>
                <div class="record-grid" id="recordGrid"></div>
            </div>
        </div>
    </div>

    <script>
        let questions = [];
        let currentQuestion = 0;
        let results = [];
        let totalScore = 0;

        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const parseInfo = document.getElementById('parseInfo');
            parseInfo.innerHTML = '<strong>æ­£åœ¨è§£ææ–‡æ¡£ï¼Œè¯·ç¨å€™...</strong>';
            parseInfo.classList.remove('hidden');

            const reader = new FileReader();
            reader.onload = function(e) {
                mammoth.extractRawText({arrayBuffer: e.target.result})
                    .then(result => {
                        const text = result.value;
                        questions = parseQuestions(text);
                        
                        if (questions.length === 0) {
                            parseInfo.innerHTML = `
                                <strong style="color: #991b1b;">âŒ æœªèƒ½è§£æåˆ°é¢˜ç›®</strong><br><br>
                                è¯·æ£€æŸ¥æ–‡æ¡£æ ¼å¼æ˜¯å¦æ­£ç¡®
                            `;
                            parseInfo.style.background = '#fee2e2';
                            parseInfo.style.borderColor = '#ef4444';
                            return;
                        }
                        
                        let questionList = '<strong>âœ“ æˆåŠŸè§£æ ' + questions.length + ' é“é¢˜ç›®ï¼</strong><br><br>';
                        questionList += '<strong>å‰5é“é¢˜é¢„è§ˆï¼š</strong><br>';
                        questions.slice(0, 5).forEach(q => {
                            const qText = q.question.substring(0, 40);
                            questionList += `${q.id}. ${qText}... (${q.answer})<br>`;
                        });
                        if (questions.length > 5) {
                            questionList += `<br>...å…± ${questions.length} é“é¢˜`;
                        }
                        
                        parseInfo.innerHTML = questionList;
                        parseInfo.style.background = '#d1fae5';
                        parseInfo.style.borderColor = '#10b981';
                        parseInfo.style.color = '#065f46';
                        
                        setTimeout(() => {
                            startQuiz();
                        }, 1500);
                    })
                    .catch(err => {
                        parseInfo.innerHTML = '<strong style="color: #991b1b;">âŒ æ–‡ä»¶è¯»å–å¤±è´¥</strong><br><br>' + err.message;
                        parseInfo.style.background = '#fee2e2';
                        parseInfo.style.borderColor = '#ef4444';
                    });
            };
            reader.readAsArrayBuffer(file);
        }

        function parseQuestions(text) {
            const questions = [];
            const lines = text.split('\n').map(l => l.trim()).filter(l => l);
            
            for (let i = 0; i < lines.length; i++) {
                let line = lines[i];
                
                // åŒ¹é…é¢˜ç›®æ ¼å¼ï¼š1. æˆ– 1ã€åé¢è·Ÿé¢˜ç›®ï¼Œæ‹¬å·ä¸­æœ‰ç­”æ¡ˆ
                const questionMatch = line.match(/^(\d+)[.ã€]\s*(.+?)[ï¼ˆ(]\s*([^)ï¼‰]+?)\s*[)ï¼‰]/);
                
                if (questionMatch) {
                    const questionNum = questionMatch[1];
                    let questionText = questionMatch[2].trim();
                    let answer = questionMatch[3].trim();
                    let options = [];
                    
                    // æ£€æŸ¥ä¸‹ä¸€è¡Œæ˜¯å¦æœ‰é€‰é¡¹
                    if (i + 1 < lines.length) {
                        const nextLine = lines[i + 1];
                        // æ£€æŸ¥æ˜¯å¦æ˜¯é€‰é¡¹è¡Œï¼ˆåŒ…å« Aã€Bã€Cã€Dï¼‰
                        if (nextLine.match(/^[A-D][ã€ï¼.]/)) {
                            // åˆ†å‰²é€‰é¡¹
                            const optionParts = nextLine.split(/(?=[A-D][ã€ï¼.])/);
                            options = optionParts.filter(opt => opt.trim()).map(opt => opt.trim());
                            i++; // è·³è¿‡é€‰é¡¹è¡Œ
                        }
                    }
                    
                    // åˆ¤æ–­é¢˜å‹
                    let type = 'fill';
                    if (options.length > 0) {
                        type = 'choice';
                    } else if (['âˆš', 'Ã—', 'å¯¹', 'é”™', 'æ­£ç¡®', 'é”™è¯¯'].includes(answer)) {
                        type = 'judge';
                    }
                    
                    questions.push({
                        id: parseInt(questionNum),
                        question: questionText,
                        options: options,
                        answer: answer,
                        type: type
                    });
                }
                
                // åŒ¹é…å¡«ç©ºé¢˜æ ¼å¼ï¼šé¢˜ç›®ã€ç­”æ¡ˆã€‘
                const fillMatch = line.match(/^(\d+)[.ã€]\s*(.+?)ã€(.+?)ã€‘/);
                if (fillMatch && !questionMatch) {
                    const questionNum = fillMatch[1];
                    let questionText = fillMatch[2].trim();
                    let answer = fillMatch[3].trim();
                    
                    questions.push({
                        id: parseInt(questionNum),
                        question: questionText + '______',
                        options: [],
                        answer: answer,
                        type: 'fill'
                    });
                }
            }
            
            return questions;
        }

        function startQuiz() {
            document.getElementById('uploadSection').classList.add('hidden');
            document.getElementById('quizSection').classList.remove('hidden');
            document.getElementById('resetBtn').classList.remove('hidden');
            document.getElementById('totalNum').textContent = questions.length;
            
            results = new Array(questions.length).fill(null);
            displayQuestion();
            updateRecordGrid();
        }

        let selectedChoice = '';

        function displayQuestion() {
            const q = questions[currentQuestion];
            selectedChoice = '';
            
            document.getElementById('currentNum').textContent = currentQuestion + 1;
            document.getElementById('questionNum').textContent = q.id;
            
            // æ˜¾ç¤ºé¢˜ç›®
            const questionTextDiv = document.getElementById('questionText');
            questionTextDiv.textContent = q.question;
            
            document.getElementById('answerInput').value = '';
            document.getElementById('answerInput').disabled = false;
            
            // éšè—æ—§çš„é€‰é¡¹åŒºåŸŸ
            document.getElementById('optionsDiv').classList.add('hidden');
            
            // æ˜¾ç¤ºé¢˜å‹æ ‡ç­¾å’Œå¯¹åº”çš„è¾“å…¥æ–¹å¼
            const badge = document.getElementById('typeBadge');
            const choiceOptions = document.getElementById('choiceOptions');
            const answerInput = document.getElementById('answerInput');
            
            if (q.type === 'choice') {
                badge.textContent = 'é€‰æ‹©é¢˜';
                badge.className = 'type-badge badge-choice';
                badge.classList.remove('hidden');
                
                // æ˜¾ç¤ºé€‰é¡¹æŒ‰é’®
                choiceOptions.innerHTML = '';
                q.options.forEach(opt => {
                    const optDiv = document.createElement('div');
                    optDiv.className = 'option';
                    optDiv.textContent = opt;
                    optDiv.onclick = function() {
                        // ç§»é™¤å…¶ä»–é€‰é¡¹çš„é€‰ä¸­çŠ¶æ€
                        document.querySelectorAll('.option').forEach(o => o.classList.remove('selected'));
                        // æ ‡è®°å½“å‰é€‰é¡¹
                        this.classList.add('selected');
                        // æå–é€‰é¡¹å­—æ¯
                        const letter = opt.match(/^([A-D])/)?.[1];
                        selectedChoice = letter;
                    };
                    choiceOptions.appendChild(optDiv);
                });
                choiceOptions.classList.remove('hidden');
                answerInput.classList.add('hidden');
                
            } else if (q.type === 'judge') {
                badge.textContent = 'åˆ¤æ–­é¢˜';
                badge.className = 'type-badge badge-judge';
                badge.classList.remove('hidden');
                
                // æ˜¾ç¤ºåˆ¤æ–­é¢˜é€‰é¡¹
                choiceOptions.innerHTML = `
                    <div class="option" onclick="selectJudge('âˆš', this)">âˆš æ­£ç¡®</div>
                    <div class="option" onclick="selectJudge('Ã—', this)">Ã— é”™è¯¯</div>
                `;
                choiceOptions.classList.remove('hidden');
                answerInput.classList.add('hidden');
                
            } else {
                badge.textContent = 'å¡«ç©ºé¢˜';
                badge.className = 'type-badge badge-fill';
                badge.classList.remove('hidden');
                
                choiceOptions.classList.add('hidden');
                answerInput.classList.remove('hidden');
                answerInput.placeholder = 'è¯·è¾“å…¥ç­”æ¡ˆ...';
            }
            
            document.getElementById('submitSection').classList.remove('hidden');
            document.getElementById('resultSection').classList.add('hidden');
            
            const progress = ((currentQuestion + 1) / questions.length) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            
            if (results[currentQuestion]) {
                showResult(results[currentQuestion]);
            }
        }

        function selectJudge(value, element) {
            document.querySelectorAll('#choiceOptions .option').forEach(o => o.classList.remove('selected'));
            element.classList.add('selected');
            selectedChoice = value;
        }

        function checkAnswer() {
            const current = questions[currentQuestion];
            let userAnswer = '';
            
            // æ ¹æ®é¢˜å‹è·å–ç­”æ¡ˆ
            if (current.type === 'choice' || current.type === 'judge') {
                userAnswer = selectedChoice;
                if (!userAnswer) {
                    alert('è¯·é€‰æ‹©ç­”æ¡ˆ');
                    return;
                }
            } else {
                userAnswer = document.getElementById('answerInput').value.trim();
                if (!userAnswer) {
                    alert('è¯·è¾“å…¥ç­”æ¡ˆ');
                    return;
                }
            }

            let isCorrect = false;
            
            const userAns = userAnswer.toUpperCase().trim();
            const correctAns = current.answer.toUpperCase().trim();
            
            if (current.type === 'choice') {
                const userLetter = userAns.match(/[A-D]/)?.[0];
                const correctLetter = correctAns.match(/[A-D]/)?.[0];
                isCorrect = userLetter === correctLetter;
            } else if (current.type === 'judge') {
                const normalize = (s) => {
                    s = s.toUpperCase();
                    return (s === 'âˆš' || s === 'å¯¹' || s === 'æ­£ç¡®') ? 'T' : 'F';
                };
                isCorrect = normalize(userAns) === normalize(correctAns);
            } else {
                isCorrect = userAns === correctAns || 
                           correctAns.includes(userAns) || 
                           userAns.includes(correctAns) ||
                           userAns.replace(/\s+/g, '') === correctAns.replace(/\s+/g, '');
            }
            
            const result = {
                userAnswer: userAnswer,
                correctAnswer: current.answer,
                isCorrect: isCorrect
            };
            
            if (!results[currentQuestion]) {
                results[currentQuestion] = result;
                if (isCorrect) totalScore++;
                document.getElementById('score').textContent = totalScore;
                document.getElementById('answered').textContent = results.filter(r => r !== null).length;
            }
            
            showResult(result);
            updateRecordGrid();
        }

        function showResult(result) {
            document.getElementById('submitSection').classList.add('hidden');
            document.getElementById('resultSection').classList.remove('hidden');
            document.getElementById('answerInput').disabled = true;
            document.getElementById('recordSection').classList.remove('hidden');
            
            const current = questions[currentQuestion];
            
            // å¦‚æœæ˜¯é€‰æ‹©é¢˜æˆ–åˆ¤æ–­é¢˜ï¼Œæ ‡è®°é€‰é¡¹çš„å¯¹é”™
            if (current.type === 'choice' || current.type === 'judge') {
                const options = document.querySelectorAll('#choiceOptions .option');
                options.forEach(opt => {
                    opt.style.pointerEvents = 'none'; // ç¦ç”¨ç‚¹å‡»
                    opt.classList.remove('selected');
                    
                    let optLetter = '';
                    if (current.type === 'choice') {
                        optLetter = opt.textContent.match(/^([A-D])/)?.[1];
                    } else {
                        optLetter = opt.textContent.includes('âˆš') ? 'âˆš' : 'Ã—';
                    }
                    
                    const correctLetter = current.answer.match(/[A-DâˆšÃ—]/)?.[0];
                    
                    if (optLetter === correctLetter) {
                        opt.classList.add('correct');
                    } else if (optLetter === result.userAnswer) {
                        opt.classList.add('wrong');
                    }
                });
            }
            
            const resultBox = document.getElementById('resultBox');
            const resultHeader = document.getElementById('resultHeader');
            
            if (result.isCorrect) {
                resultBox.className = 'result-box result-correct';
                resultHeader.innerHTML = 'âœ“ å›ç­”æ­£ç¡®ï¼';
                document.getElementById('correctAnsDiv').style.display = 'none';
            } else {
                resultBox.className = 'result-box result-wrong';
                resultHeader.innerHTML = 'âœ— å›ç­”é”™è¯¯';
                document.getElementById('correctAnsDiv').style.display = 'block';
                document.getElementById('correctAns').textContent = result.correctAnswer;
            }
            
            document.getElementById('userAns').textContent = result.userAnswer;
            
            document.getElementById('prevBtn').disabled = currentQuestion === 0;
            
            if (currentQuestion === questions.length - 1) {
                document.getElementById('nextBtn').classList.add('hidden');
                document.getElementById('finishBtn').classList.remove('hidden');
            } else {
                document.getElementById('nextBtn').classList.remove('hidden');
                document.getElementById('finishBtn').classList.add('hidden');
            }
        }

        function nextQuestion() {
            if (currentQuestion < questions.length - 1) {
                currentQuestion++;
                displayQuestion();
            }
        }

        function prevQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                displayQuestion();
            }
        }

        function updateRecordGrid() {
            const grid = document.getElementById('recordGrid');
            grid.innerHTML = '';
            
            questions.forEach((_, idx) => {
                const item = document.createElement('div');
                item.className = 'record-item';
                item.textContent = idx + 1;
                
                if (!results[idx]) {
                    item.classList.add('unanswered');
                } else if (results[idx].isCorrect) {
                    item.classList.add('correct');
                } else {
                    item.classList.add('wrong');
                }
                
                if (idx === currentQuestion) {
                    item.classList.add('active');
                }
                
                item.onclick = () => {
                    currentQuestion = idx;
                    displayQuestion();
                    updateRecordGrid();
                };
                
                grid.appendChild(item);
            });
        }

        function finishQuiz() {
            const total = questions.length;
            const answered = results.filter(r => r !== null).length;
            const correct = totalScore;
            const wrong = answered - totalScore;
            const rate = total > 0 ? ((correct / total) * 100).toFixed(1) : 0;
            
            alert(`æµ‹éªŒå®Œæˆï¼\n\næ€»é¢˜æ•°ï¼š${total}\nå·²ç­”é¢˜ï¼š${answered}\næ­£ç¡®ï¼š${correct}\né”™è¯¯ï¼š${wrong}\næ­£ç¡®ç‡ï¼š${rate}%`);
        }

        function resetQuiz() {
            if (confirm('ç¡®å®šè¦é‡æ–°å¼€å§‹å—ï¼Ÿå½“å‰è¿›åº¦å°†ä¼šä¸¢å¤±ã€‚')) {
                questions = [];
                currentQuestion = 0;
                results = [];
                totalScore = 0;
                
                document.getElementById('uploadSection').classList.remove('hidden');
                document.getElementById('quizSection').classList.add('hidden');
                document.getElementById('resetBtn').classList.add('hidden');
                document.getElementById('fileInput').value = '';
                document.getElementById('parseInfo').classList.add('hidden');
            }
        }
    </script>
</body>
</html>
